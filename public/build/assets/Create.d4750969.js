import{I as C}from"./Input.47b7b4a9.js";import{T as D}from"./TextArea.c22bdae9.js";import{_ as M,c as p,a as r,b as t,y as U,w as I,t as a,F as N,r as E,d as g,h as L,f as _,o as h,e as b,v}from"./app.4060d334.js";import{S as A}from"./SubmitButton.94bb04f8.js";import{D as q}from"./DatePicker.67be254a.js";import{S as B}from"./InputSpinner.vue_vue_type_style_index_0_scoped_f3ddc209_lang.9416471f.js";import"./bootstrap.esm.c86673ca.js";import"./debounce.b911da70.js";const K={components:{SearchCustomer:B,TextArea:D,Input:C,DatePicker:q,SubmitButton:A},props:["data","existing_record"],computed:{calculateTotal(){let e=0,o=0;this.form.discount&&(o=parseFloat(this.form.discount));let l=0;for(let s=0;s<this.form.invoice_items.length;s++){const m=this.form.invoice_items[s];let y=parseFloat(m.quantity),V=parseFloat(m.price);const c=y*V;this.form.invoice_items[s].sub_total=this.formatMoney(c),e=e+c}this.data.enable_sales_tax&&(l=this.calculateSalesTax(e)),o>e&&(o=0,this.form.discount=o);let k=e-o+l;return this.sub_total=e,this.sales_tax_amount=l,this.formatMoney(k)}},watch:{"form.customer_id":{handler(e){this.getUnInvoicedTasks(e)},deep:!0}},created(){},data(){return{form:this.$inertia.form(this.prepareForm()),sales_tax_amount:0,sub_total:0}},methods:{prepareForm(){let e={customer_id:null,invoice_date:new Date,due_date:null,invoice_items:[],billing_address:null,admin_note:null,customer_note:null,terms_and_conditions:null,discount:0};return this.existing_record&&(e={...e,...this.existing_record}),this.existing_record&&this.existing_record.customer_id&&this.getUnInvoicedTasks(this.existing_record.customer_id),e},calculateSalesTax(e){return this.data.enable_sales_tax&&this.data.sales_tax_rate?Math.round(e*this.data.sales_tax_rate/100,2):0},prepareInvoiceLineFromTasks(e){for(let o=0;o<e.length;o++){let l=e[o];this.form.invoice_items.push({linked_task_id:l.id,linked_task_number:l.number,name:l.service.name,description:l.title,price:l.total,quantity:1,sub_total:l.total})}},getUnInvoicedTasks(e){axios.post(route("admin.invoices.tasks.not_invoiced"),{customer_id:e}).then(o=>{this.prepareInvoiceLineFromTasks(o.data)})},addNewLine(){this.form.invoice_items.push({linked_task_id:"",linked_task_number:"",name:"",description:"",price:0,quantity:1,sub_total:0})},removeLine(e){this.form.invoice_items.splice(e,1)},getErrorFieldName(e,o){return"invoice_items."+[o]+"."+e},restrictEmpty(e,o){const l=this.form.invoice_items[o][e];(!l||l=="")&&(this.form.invoice_items[o][e]=0)}}},P={class:"container page-container"},x=t("i",{class:"fa-solid fa-arrow-left-long"},null,-1),H={class:"row"},Q={class:"col-md-6"},R={class:"col-md-6"},j={class:"col-md-12"},z={class:"table table-sm"},G={class:"table-secondary"},J={class:"col-md-2"},O={class:"col-md-2"},W={class:"col-md-2"},X={class:"col-md-1"},Y={class:"col-md-2"},Z={class:"col-md-2 text-end"},$=t("th",{class:"col-md-1"},null,-1),ee=["onUpdate:modelValue"],te=["onUpdate:modelValue"],oe=["onUpdate:modelValue","onKeypress"],se=["onUpdate:modelValue","onKeypress"],ne={class:"text-end"},le={class:"text-end"},ie=["onClick"],ae=t("i",{class:"fa-solid fa-trash-can"},null,-1),re=[ae],me={colspan:"7"},de={class:"text-end",colspan:"6"},_e={class:"text-end"},ue={class:"text-end",colspan:"6"},ce={class:"text-end"},fe={class:"text-end",colspan:"6"},pe={key:0,class:"text-muted"},he={class:"text-end"},be={class:"text-end",colspan:"6"},ve={class:"text-end"},ye={class:"row"},Ve={class:"col-md-6"},ge={class:"col-md-6"},ke={class:"col-md-12"};function Te(e,o,l,k,s,m){const y=_("AppHead"),V=_("Link"),c=_("PageTitle"),w=_("SearchCustomer"),f=_("TextArea"),T=_("DatePicker"),u=_("ValidationError"),F=_("Input"),S=_("SubmitButton");return h(),p(N,null,[r(y,{title:l.data.title},null,8,["title"]),t("div",P,[r(c,{title:l.data.title},{default:U(()=>[r(V,{class:"btn btn-sm btn-light",href:e.route("admin.invoices.index")},{default:U(()=>[x,g(" "+a(e.__("Back to invoices")),1)]),_:1},8,["href"])]),_:1},8,["title"]),t("form",{onSubmit:o[10]||(o[10]=I(n=>s.form.post(e.route("admin.invoices.store"),e.formConfig),["prevent"]))},[t("div",H,[t("div",Q,[r(w,{options:l.data.dropdowns.customers,modelValue:s.form.customer_id,"onUpdate:modelValue":o[0]||(o[0]=n=>s.form.customer_id=n),label:e.__("Customer"),name:"customer_id"},null,8,["options","modelValue","label"]),r(f,{modelValue:s.form.billing_address,"onUpdate:modelValue":o[1]||(o[1]=n=>s.form.billing_address=n),rows:"2",label:e.__("Billing Address"),name:"billing_address"},null,8,["modelValue","label"])]),t("div",R,[r(T,{format:"yyyy-MM-dd",modelValue:s.form.invoice_date,"onUpdate:modelValue":o[2]||(o[2]=n=>s.form.invoice_date=n),label:e.__("Invoice Date"),name:"invoice_date"},null,8,["modelValue","label"]),r(T,{format:"yyyy-MM-dd",modelValue:s.form.due_date,"onUpdate:modelValue":o[3]||(o[3]=n=>s.form.due_date=n),label:e.__("Due Date"),name:"due_date"},null,8,["modelValue","label"])]),t("div",j,[t("table",z,[t("thead",G,[t("tr",null,[t("th",J,a(e.__("Task")),1),t("th",O,a(e.__("Item")),1),t("th",W,a(e.__("Description")),1),t("th",X,a(e.__("Quantity")),1),t("th",Y,a(e.__("Rate")),1),t("th",Z,a(e.__("Amount")),1),$])]),t("tbody",null,[(h(!0),p(N,null,E(s.form.invoice_items,(n,i)=>(h(),p("tr",{key:i},[t("td",null,a(n.linked_task_number),1),t("td",null,[b(t("textarea",{class:"form-control form-control-sm","onUpdate:modelValue":d=>s.form.invoice_items[i].name=d},null,8,ee),[[v,s.form.invoice_items[i].name]]),r(u,{name:m.getErrorFieldName("name",i)},null,8,["name"])]),t("td",null,[b(t("textarea",{class:"form-control form-control-sm","onUpdate:modelValue":d=>s.form.invoice_items[i].description=d},null,8,te),[[v,s.form.invoice_items[i].description]]),r(u,{name:m.getErrorFieldName("description",i)},null,8,["name"])]),t("td",null,[b(t("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":d=>s.form.invoice_items[i].quantity=d,onKeypress:d=>e.onlyNumber(d,s.form.invoice_items[i].quantity)},null,40,oe),[[v,s.form.invoice_items[i].quantity]]),r(u,{name:m.getErrorFieldName("quantity",i)},null,8,["name"])]),t("td",null,[b(t("input",{class:"form-control form-control-sm",type:"text","onUpdate:modelValue":d=>s.form.invoice_items[i].price=d,onKeypress:d=>e.onlyNumber(d,s.form.invoice_items[i].price)},null,40,se),[[v,s.form.invoice_items[i].price]]),r(u,{name:m.getErrorFieldName("price",i)},null,8,["name"])]),t("td",ne,[g(a(s.form.invoice_items[i].sub_total)+" ",1),r(u,{name:m.getErrorFieldName("sub_total",i)},null,8,["name"])]),t("td",le,[t("button",{type:"button",onClick:d=>m.removeLine(i),class:"btn btn-sm btn-danger"},re,8,ie)])]))),128)),t("tr",null,[t("td",me,[t("button",{type:"button",onClick:o[4]||(o[4]=(...n)=>m.addNewLine&&m.addNewLine(...n)),class:"btn btn-sm btn-success"},a(e.__("Add new line")),1)])])]),t("tfoot",null,[t("tr",null,[t("th",de,a(e.__("Sub Total")),1),t("th",_e,a(e.formatMoney(s.sub_total)),1)]),t("tr",null,[t("th",ue,a(e.__("Discount")),1),t("th",ce,[r(F,{modelValue:s.form.discount,"onUpdate:modelValue":o[5]||(o[5]=n=>s.form.discount=n),name:"discount",onKeypress:o[6]||(o[6]=n=>e.onlyNumber(n,s.form.discount)),customStyle:"text-end"},null,8,["modelValue"])])]),t("tr",null,[t("th",fe,[t("div",null,[g(a(e.__("Sales Tax"))+" ",1),l.data.enable_sales_tax?(h(),p("small",pe,"("+a(Math.round(l.data.sales_tax_rate,2))+"%)",1)):L("",!0)])]),t("th",he,a(e.formatMoney(s.sales_tax_amount)),1)]),t("tr",null,[t("th",be,a(e.__("Total")),1),t("th",ve,a(m.calculateTotal),1)])])])])]),t("div",ye,[t("div",Ve,[r(f,{modelValue:s.form.admin_note,"onUpdate:modelValue":o[7]||(o[7]=n=>s.form.admin_note=n),name:"admin_note",label:e.__("Admin Note")},null,8,["modelValue","label"])]),t("div",ge,[r(f,{modelValue:s.form.customer_note,"onUpdate:modelValue":o[8]||(o[8]=n=>s.form.customer_note=n),name:"customer_note",label:e.__("Customer Note")},null,8,["modelValue","label"])]),t("div",ke,[r(f,{modelValue:s.form.terms_and_conditions,"onUpdate:modelValue":o[9]||(o[9]=n=>s.form.terms_and_conditions=n),name:"terms_and_conditions",label:e.__("Terms & Condition")},null,8,["modelValue","label"])])]),r(S,{disabled:s.form.processing},null,8,["disabled"])],32)])],64)}const Ie=M(K,[["render",Te]]);export{Ie as default};
